version: v2beta1
name: gitactiontoimage


deployments:
  fastapi:
    kubectl:
      manifests:
        - ./fastapi-deployment.yaml

dev:
  fastapi:
    container: fastapi
    labelSelector:
      app: fastapi-hello   # 🔥 關鍵！指定這個 label，DevSpace 就能準確找 pod
    command:
      - uvicorn
      - main:app
      - --host
      - 0.0.0.0
      - --port
      - "80"
      - --reload
    sync:
      - path: ./
        excludePaths:
          - .git/
          - .venv/
          - __pycache__/

commands:
  deploy-service-once:
    command: kubectl apply -f fastapi-service.yaml
    description: 初次部署 Service（NodePort 不變）
